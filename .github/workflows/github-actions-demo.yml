name: simulink_pipeline

on:
  push:
  workflow_dispatch:

permissions:
  checks: write
  contents: read

env:
  PATH_TO_MATLAB: "C:\\Program Files\\MATLAB\\R2025b\\bin\\win64"

jobs:
  # Restore_Cache:
  #   runs-on:
  #     self-hosted
  #
  #   steps:
  #     - name:
  #         Checkout Repository
  #
  #       uses:
  #         actions/checkout@v4
  #
  #     - name:
  #         Restore Cache
  #
  #       uses:
  #         actions/cache@v4
  #
  #       with:
  #         key:
  #           padv_artifacts-${{ github.run_id }}-${{ github.run_attempt }}
  #
  #         restore-keys:
  #           padv_artifacts-cache
  #
  #         path:
  #           |
  #           03_Code
  #           04_Results\AHRS_Voter\code_inspection
  #           04_Results\AHRS_Voter\design_error_detections
  #           04_Results\AHRS_Voter\metrics
  #           04_Results\AHRS_Voter\model_comparison
  #           04_Results\AHRS_Voter\model_standards_results
  #           04_Results\AHRS_Voter\system_design_description
  #           04_Results\AHRS_Voter\webview
  #           04_Results\Actuator_Control\code_inspection
  #           04_Results\Actuator_Control\design_error_detections
  #           04_Results\Actuator_Control\metrics
  #           04_Results\Actuator_Control\model_comparison
  #           04_Results\Actuator_Control\model_standards_results
  #           04_Results\Actuator_Control\system_design_description
  #           04_Results\Actuator_Control\webview
  #           04_Results\Flight_Control\code_inspection
  #           04_Results\Flight_Control\design_error_detections
  #           04_Results\Flight_Control\metrics
  #           04_Results\Flight_Control\model_comparison
  #           04_Results\Flight_Control\model_standards_results
  #           04_Results\Flight_Control\system_design_description
  #           04_Results\Flight_Control\webview
  #           04_Results\InnerLoop_Control\code_inspection
  #           04_Results\InnerLoop_Control\design_error_detections
  #           04_Results\InnerLoop_Control\metrics
  #           04_Results\InnerLoop_Control\model_comparison
  #           04_Results\InnerLoop_Control\model_standards_results
  #           04_Results\InnerLoop_Control\system_design_description
  #           04_Results\InnerLoop_Control\webview
  #           04_Results\OuterLoop_Control\code_inspection
  #           04_Results\OuterLoop_Control\design_error_detections
  #           04_Results\OuterLoop_Control\metrics
  #           04_Results\OuterLoop_Control\model_comparison
  #           04_Results\OuterLoop_Control\model_standards_results
  #           04_Results\OuterLoop_Control\system_design_description
  #           04_Results\OuterLoop_Control\webview
  #           04_Results\test_results\findAcrossModelClones
  #           04_Results\test_results\findLibraryClones
  #           derived\artifacts.dmr
  #
  #
  #     - name:
  #         Upload Artifacts
  #
  #       if:
  #         ${{ !cancelled() }}
  #
  #       uses:
  #         actions/upload-artifact@v4
  #
  #       with:
  #         name:
  #           Restore_Cache_padv_artifacts
  #
  #         path:
  #           |
  #           derived\artifacts.dmr
  #           03_Code
  #           04_Results\AHRS_Voter\code_inspection
  #           04_Results\AHRS_Voter\design_error_detections
  #           04_Results\AHRS_Voter\metrics
  #           04_Results\AHRS_Voter\model_comparison
  #           04_Results\AHRS_Voter\model_standards_results
  #           04_Results\AHRS_Voter\system_design_description
  #           04_Results\AHRS_Voter\webview
  #           04_Results\Actuator_Control\code_inspection
  #           04_Results\Actuator_Control\design_error_detections
  #           04_Results\Actuator_Control\metrics
  #           04_Results\Actuator_Control\model_comparison
  #           04_Results\Actuator_Control\model_standards_results
  #           04_Results\Actuator_Control\system_design_description
  #           04_Results\Actuator_Control\webview
  #           04_Results\Flight_Control\code_inspection
  #           04_Results\Flight_Control\design_error_detections
  #           04_Results\Flight_Control\metrics
  #           04_Results\Flight_Control\model_comparison
  #           04_Results\Flight_Control\model_standards_results
  #           04_Results\Flight_Control\system_design_description
  #           04_Results\Flight_Control\webview
  #           04_Results\InnerLoop_Control\code_inspection
  #           04_Results\InnerLoop_Control\design_error_detections
  #           04_Results\InnerLoop_Control\metrics
  #           04_Results\InnerLoop_Control\model_comparison
  #           04_Results\InnerLoop_Control\model_standards_results
  #           04_Results\InnerLoop_Control\system_design_description
  #           04_Results\InnerLoop_Control\webview
  #           04_Results\OuterLoop_Control\code_inspection
  #           04_Results\OuterLoop_Control\design_error_detections
  #           04_Results\OuterLoop_Control\metrics
  #           04_Results\OuterLoop_Control\model_comparison
  #           04_Results\OuterLoop_Control\model_standards_results
  #           04_Results\OuterLoop_Control\system_design_description
  #           04_Results\OuterLoop_Control\webview
  #           04_Results\test_results\findAcrossModelClones
  #           04_Results\test_results\findLibraryClones
  #
  #         retention-days:
  #           30
  #
  #
  # Runprocess:
  #   if:
  #     ${{ !cancelled() }}
  #
  #   needs:
  #     Restore_Cache
  #
  #   runs-on:
  #     self-hosted
  #
  #   steps:
  #     - name:
  #         Checkout Repository
  #
  #       uses:
  #         actions/checkout@v4
  #
  #     - name:
  #         Download Artifacts
  #
  #       uses:
  #         actions/download-artifact@v4
  #
  #       with:
  #         name:
  #           Restore_Cache_padv_artifacts

 runprocess:
    if: ${{ !cancelled() }}
    runs-on: [self-hosted, Windows]   # Make sure your runner label matches
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Add MATLAB to PATH (cmd.exe)
      shell: cmd
      run: |
        echo %PATH_TO_MATLAB%>>%GITHUB_PATH%

    - name: Launch MATLAB (cmd.exe)
      shell: cmd
      run: |
        matlab -nodesktop -logfile output.log -batch "openProject(pwd);runprocess(Process = 'CIPipeline', Force = false, ExitInBatchMode = true, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = false);"

    - name: Debug – list Process Advisor outputs (cmd.exe)
      shell: cmd
      run: |
        dir /s /b

  # runprocess:
  #   if: ${{ !cancelled() }}
  #   runs-on: self-hosted
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4

  #     - name: Setup MATLAB
  #       shell: powershell
  #       run: |
  #         $env:PATH_TO_MATLAB | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

  #     - name: Launch MATLAB
  #       shell: powershell
  #       run: >
  #         matlab
  #         -nodesktop
  #         -logfile output.log
  #         -batch "openProject(pwd);runprocess(Process = 'CIPipeline', Force = false, ExitInBatchMode = true, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = false);"

  #     - name: Debug – list Process Advisor outputs
  #       shell: powershell
  #       run: |
  #         Write-Host "=== Workspace contents after PADV ==="
  #         Get-ChildItem -Recurse -Force

  #     - name:
  #         Upload Artifacts
  #
  #       if:
  #         ${{ !cancelled() }}
  #
  #       uses:
  #         actions/upload-artifact@v4
  #
  #       with:
  #         name:
  #           Runprocess_padv_artifacts
  #
  #         path:
  #           |
  #           derived\artifacts.dmr
  #           03_Code
  #           04_Results\AHRS_Voter\code_inspection
  #           04_Results\AHRS_Voter\design_error_detections
  #           04_Results\AHRS_Voter\metrics
  #           04_Results\AHRS_Voter\model_comparison
  #           04_Results\AHRS_Voter\model_standards_results
  #           04_Results\AHRS_Voter\system_design_description
  #           04_Results\AHRS_Voter\webview
  #           04_Results\Actuator_Control\code_inspection
  #           04_Results\Actuator_Control\design_error_detections
  #           04_Results\Actuator_Control\metrics
  #           04_Results\Actuator_Control\model_comparison
  #           04_Results\Actuator_Control\model_standards_results
  #           04_Results\Actuator_Control\system_design_description
  #           04_Results\Actuator_Control\webview
  #           04_Results\Flight_Control\code_inspection
  #           04_Results\Flight_Control\design_error_detections
  #           04_Results\Flight_Control\metrics
  #           04_Results\Flight_Control\model_comparison
  #           04_Results\Flight_Control\model_standards_results
  #           04_Results\Flight_Control\system_design_description
  #           04_Results\Flight_Control\webview
  #           04_Results\InnerLoop_Control\code_inspection
  #           04_Results\InnerLoop_Control\design_error_detections
  #           04_Results\InnerLoop_Control\metrics
  #           04_Results\InnerLoop_Control\model_comparison
  #           04_Results\InnerLoop_Control\model_standards_results
  #           04_Results\InnerLoop_Control\system_design_description
  #           04_Results\InnerLoop_Control\webview
  #           04_Results\OuterLoop_Control\code_inspection
  #           04_Results\OuterLoop_Control\design_error_detections
  #           04_Results\OuterLoop_Control\metrics
  #           04_Results\OuterLoop_Control\model_comparison
  #           04_Results\OuterLoop_Control\model_standards_results
  #           04_Results\OuterLoop_Control\system_design_description
  #           04_Results\OuterLoop_Control\webview
  #           04_Results\test_results\findAcrossModelClones
  #           04_Results\test_results\findLibraryClones
  #
  #         retention-days:
  #           30
  #
  #
  #
  #
  # Generate_PADV_Report:
  #   if:
  #     ${{ !cancelled() }}
  #
  #   needs:
  #     Runprocess
  #
  #   runs-on:
  #     self-hosted
  #
  #   steps:
  #     - name:
  #         Checkout Repository
  #
  #       uses:
  #         actions/checkout@v4
  #
  #     - name:
  #         Download Artifacts
  #
  #       uses:
  #         actions/download-artifact@v4
  #
  #       with:
  #         name:
  #           Restore_Cache_padv_artifacts
  #
  #
  #     - name:
  #         Download Artifacts
  #
  #       uses:
  #         actions/download-artifact@v4
  #
  #       with:
  #         name:
  #           Runprocess_padv_artifacts
  #
  #
  #     - name:
  #         Setup MATLAB
  #
  #       run:
  #         echo "$PATH_TO_MATLAB" &gt;&gt; $GITHUB_PATH
  #
  #     - name:
  #         Generate PADV Report
  #
  #       run:
  #         &gt;
  #         matlab 
  #         -nodesktop 
  #         -logfile output.log 
  #         -batch "openProject(pwd);
  #         rptObj=padv.ProcessAdvisorReportGenerator(Process = 'CIPipeline', Format='pdf', OutputPath=fullfile(currentProject().RootFolder,'ProcessAdvisorReport'));
  #         rptObj.generateReport();" 
  #
  #     - name:
  #         Upload Artifacts
  #
  #       if:
  #         ${{ !cancelled() }}
  #
  #       uses:
  #         actions/upload-artifact@v4
  #
  #       with:
  #         name:
  #           Generate_PADV_Report_padv_artifacts
  #
  #         path:
  #           |
  #           derived\artifacts.dmr
  #           ProcessAdvisorReport.pdf
  #
  #         retention-days:
  #           30
  #
  #
  #
  #
  # Collect_Artifacts:
  #   if:
  #     ${{ !cancelled() }}
  #
  #   needs:
  #     Generate_PADV_Report
  #
  #   runs-on:
  #     self-hosted
  #
  #   steps:
  #     - name:
  #         Download Artifacts
  #
  #       uses:
  #         actions/download-artifact@v4
  #
  #       with:
  #         name:
  #           Restore_Cache_padv_artifacts
  #
  #
  #     - name:
  #         Download Artifacts
  #
  #       uses:
  #         actions/download-artifact@v4
  #
  #       with:
  #         name:
  #           Runprocess_padv_artifacts
  #
  #
  #     - name:
  #         Download Artifacts
  #
  #       uses:
  #         actions/download-artifact@v4
  #
  #       with:
  #         name:
  #           Generate_PADV_Report_padv_artifacts
  #
  #
  #     - name:
  #         Upload Artifacts
  #
  #       if:
  #         ${{ !cancelled() }}
  #
  #       uses:
  #         actions/upload-artifact@v4
  #
  #       with:
  #         name:
  #           Collect_Artifacts_padv_artifacts
  #
  #         path:
  #           |
  #           derived\artifacts.dmr
  #           03_Code
  #           04_Results\AHRS_Voter\code_inspection
  #           04_Results\AHRS_Voter\design_error_detections
  #           04_Results\AHRS_Voter\metrics
  #           04_Results\AHRS_Voter\model_comparison
  #           04_Results\AHRS_Voter\model_standards_results
  #           04_Results\AHRS_Voter\system_design_description
  #           04_Results\AHRS_Voter\webview
  #           04_Results\Actuator_Control\code_inspection
  #           04_Results\Actuator_Control\design_error_detections
  #           04_Results\Actuator_Control\metrics
  #           04_Results\Actuator_Control\model_comparison
  #           04_Results\Actuator_Control\model_standards_results
  #           04_Results\Actuator_Control\system_design_description
  #           04_Results\Actuator_Control\webview
  #           04_Results\Flight_Control\code_inspection
  #           04_Results\Flight_Control\design_error_detections
  #           04_Results\Flight_Control\metrics
  #           04_Results\Flight_Control\model_comparison
  #           04_Results\Flight_Control\model_standards_results
  #           04_Results\Flight_Control\system_design_description
  #           04_Results\Flight_Control\webview
  #           04_Results\InnerLoop_Control\code_inspection
  #           04_Results\InnerLoop_Control\design_error_detections
  #           04_Results\InnerLoop_Control\metrics
  #           04_Results\InnerLoop_Control\model_comparison
  #           04_Results\InnerLoop_Control\model_standards_results
  #           04_Results\InnerLoop_Control\system_design_description
  #           04_Results\InnerLoop_Control\webview
  #           04_Results\OuterLoop_Control\code_inspection
  #           04_Results\OuterLoop_Control\design_error_detections
  #           04_Results\OuterLoop_Control\metrics
  #           04_Results\OuterLoop_Control\model_comparison
  #           04_Results\OuterLoop_Control\model_standards_results
  #           04_Results\OuterLoop_Control\system_design_description
  #           04_Results\OuterLoop_Control\webview
  #           04_Results\test_results\findAcrossModelClones
  #           04_Results\test_results\findLibraryClones
  #
  #         retention-days:
  #           30
  #
  #
  #     - name:
  #         Save Cache
  #
  #       uses:
  #         actions/cache@v4
  #
  #       with:
  #         key:
  #           padv_artifacts-cache-${{ github.sha }}
  #
  #         path:
  #           |
  #           03_Code
  #           04_Results\AHRS_Voter\code_inspection
  #           04_Results\AHRS_Voter\design_error_detections
  #           04_Results\AHRS_Voter\metrics
  #           04_Results\AHRS_Voter\model_comparison
  #           04_Results\AHRS_Voter\model_standards_results
  #           04_Results\AHRS_Voter\system_design_description
  #           04_Results\AHRS_Voter\webview
  #           04_Results\Actuator_Control\code_inspection
  #           04_Results\Actuator_Control\design_error_detections
  #           04_Results\Actuator_Control\metrics
  #           04_Results\Actuator_Control\model_comparison
  #           04_Results\Actuator_Control\model_standards_results
  #           04_Results\Actuator_Control\system_design_description
  #           04_Results\Actuator_Control\webview
  #           04_Results\Flight_Control\code_inspection
  #           04_Results\Flight_Control\design_error_detections
  #           04_Results\Flight_Control\metrics
  #           04_Results\Flight_Control\model_comparison
  #           04_Results\Flight_Control\model_standards_results
  #           04_Results\Flight_Control\system_design_description
  #           04_Results\Flight_Control\webview
  #           04_Results\InnerLoop_Control\code_inspection
  #           04_Results\InnerLoop_Control\design_error_detections
  #           04_Results\InnerLoop_Control\metrics
  #           04_Results\InnerLoop_Control\model_comparison
  #           04_Results\InnerLoop_Control\model_standards_results
  #           04_Results\InnerLoop_Control\system_design_description
  #           04_Results\InnerLoop_Control\webview
  #           04_Results\OuterLoop_Control\code_inspection
  #           04_Results\OuterLoop_Control\design_error_detections
  #           04_Results\OuterLoop_Control\metrics
  #           04_Results\OuterLoop_Control\model_comparison
  #           04_Results\OuterLoop_Control\model_standards_results
  #           04_Results\OuterLoop_Control\system_design_description
  #           04_Results\OuterLoop_Control\webview
  #           04_Results\test_results\findAcrossModelClones
  #           04_Results\test_results\findLibraryClones
  #           derived\artifacts.dmr
